{% extends "base.html" %}

{% block title %}ë©”ì‹œì§€ ì „ì†¡ - í…”ë ˆê·¸ë¨ ì „ì†¡ ëŒ€ìƒ ê´€ë¦¬{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-paper-plane"></i> ë©”ì‹œì§€ ì „ì†¡</h5>
            </div>
            <div class="card-body">
                <form method="POST">
                    <div class="mb-3">
                        <label for="message" class="form-label">
                            <i class="fas fa-comment"></i> ë©”ì‹œì§€ ë‚´ìš© <span class="text-danger">*</span>
                        </label>
                        <textarea class="form-control" id="message" name="message" rows="6" 
                                  placeholder="ì „ì†¡í•  ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." required></textarea>
                        <div class="form-text">
                            <i class="fas fa-info-circle"></i> 
                            HTML íƒœê·¸ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆ: &lt;b&gt;êµµì€ ê¸€ì”¨&lt;/b&gt;, &lt;i&gt;ê¸°ìš¸ì„&lt;/i&gt;
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">
                            <i class="fas fa-users"></i> ì „ì†¡ ëŒ€ìƒ
                        </label>
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle"></i>
                            <strong>{{ active_users|length }}ëª…</strong>ì˜ í™œì„± ì‚¬ìš©ìì—ê²Œ ì „ì†¡ë©ë‹ˆë‹¤.
                        </div>
                    </div>
                    
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <button type="button" class="btn btn-outline-secondary" onclick="previewMessage()">
                            <i class="fas fa-eye"></i> ë¯¸ë¦¬ë³´ê¸°
                        </button>
                        <button type="submit" class="btn btn-telegram">
                            <i class="fas fa-paper-plane"></i> ë©”ì‹œì§€ ì „ì†¡
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0"><i class="fas fa-list"></i> ì „ì†¡ ëŒ€ìƒ ëª©ë¡</h6>
            </div>
            <div class="card-body">
                {% if active_users %}
                    <div class="list-group">
                        {% for user_id in active_users %}
                            <div class="list-group-item d-flex justify-content-between align-items-center">
                                <span><i class="fas fa-user"></i> {{ user_id }}</span>
                                <span class="badge bg-success">í™œì„±</span>
                            </div>
                        {% endfor %}
                    </div>
                    
                    <div class="mt-3">
                        <a href="{{ url_for('users') }}" class="btn btn-outline-primary btn-sm">
                            <i class="fas fa-cog"></i> ì‚¬ìš©ì ê´€ë¦¬
                        </a>
                    </div>
                {% else %}
                    <div class="text-center text-muted">
                        <i class="fas fa-exclamation-triangle fa-2x mb-2"></i>
                        <p>í™œì„± ì‚¬ìš©ìê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                        <a href="{{ url_for('users') }}" class="btn btn-primary btn-sm">
                            <i class="fas fa-user-plus"></i> ì‚¬ìš©ì ì¶”ê°€
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>
        
        <div class="card mt-3">
            <div class="card-header">
                <h6 class="mb-0"><i class="fas fa-magic"></i> ë¹ ë¥¸ í…œí”Œë¦¿</h6>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <button class="btn btn-outline-primary btn-sm" onclick="insertTemplate('greeting')">
                        <i class="fas fa-hand-wave"></i> ì¸ì‚¬ë§
                    </button>
                    <button class="btn btn-outline-success btn-sm" onclick="insertTemplate('notice')">
                        <i class="fas fa-bullhorn"></i> ê³µì§€ì‚¬í•­
                    </button>
                    <button class="btn btn-outline-info btn-sm" onclick="insertTemplate('test')">
                        <i class="fas fa-vial"></i> í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ë¯¸ë¦¬ë³´ê¸° ëª¨ë‹¬ -->
<div class="modal fade" id="previewModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="fas fa-eye"></i> ë©”ì‹œì§€ ë¯¸ë¦¬ë³´ê¸°</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="border p-3 rounded bg-light">
                    <div id="previewContent"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ë‹«ê¸°</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function previewMessage() {
    const message = document.getElementById('message').value;
    if (!message.trim()) {
        alert('ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
        return;
    }
    
    document.getElementById('previewContent').innerHTML = message;
    new bootstrap.Modal(document.getElementById('previewModal')).show();
}

function insertTemplate(type) {
    const textarea = document.getElementById('message');
    let template = '';
    
    switch(type) {
        case 'greeting':
            template = 'ì•ˆë…•í•˜ì„¸ìš”! í…”ë ˆê·¸ë¨ ë©”ì‹œì§€ ì „ì†¡ í…ŒìŠ¤íŠ¸ì…ë‹ˆë‹¤. ğŸš€';
            break;
        case 'notice':
            template = '<b>ğŸ“¢ ê³µì§€ì‚¬í•­</b>\n\nì•ˆë…•í•˜ì„¸ìš”.\n\nì¤‘ìš”í•œ ê³µì§€ì‚¬í•­ì„ ì „ë‹¬ë“œë¦½ë‹ˆë‹¤.\n\nê°ì‚¬í•©ë‹ˆë‹¤.';
            break;
        case 'test':
            template = 'í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€ì…ë‹ˆë‹¤.\n\nì „ì†¡ ì‹œê°„: ' + new Date().toLocaleString();
            break;
    }
    
    textarea.value = template;
    textarea.focus();
}
</script>
{% endblock %}
